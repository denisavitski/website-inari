# Карта

## Подключение

Карта подключается в `<head>` страницы следующим образом:

```html
<script
  is:inline
  src="https://api-maps.yandex.ru/2.1/?coordorder=longlat&apikey=ВАШ_КЛЮЧ&lang=ru_RU"
  type="text/javascript"
></script>
```

**Для работы карты необходимо создать собственный API-ключ** — сделать это можно [здесь](https://developer.tech.yandex.ru/services/3).
Более подробную информацию по подключению можно найти в [документации](https://yandex.ru/dev/jsapi30/doc/ru/common/quickstart) в разделе «Быстрый старт».

## Конструктор

Карта редактируется и выгружается [отсюда](https://yandex.ru/map-constructor/).

Если необходимо внести изменения на карте, импортируйте [этот](../../public/map.geojson) файл в [конструктор](https://yandex.ru/map-constructor/), внесите правки и экспортируйте данные в том же формате. Затем замените [этот](../../public/map.geojson) файл на обновлённый.

В конструкторе у всех зон есть названия, которые должны точно соответствовать названиям, используемым в элементах `<e-delivery-zone></e-delivery-zone>` (описание ниже).

<img src="./1.png"></img>

Также в конструкторе есть точки самовывоза, их названия и описания используются при построении разметки.

Данные отсюда:

<img src="./2.png"></img>

Передаются сюда:

<img src="./3.png"></img>

## Зоны доставки

В разметке есть элементы, данные из которых используются для определения цены доставки для указанного юзером адреса. Пример разметки:

```html
<e-delivery-zone
  class="visually-hidden"
  name="зона 1"
  description="Бесплатная доставка при заказе от 1300р. с учётом скидок"
  addition="При меньшей сумме заказа доставка платная - 300 руб."
  free="1300"
  price="300"
></e-delivery-zone>
```

- `name` - название зоны, должно совпадать с названием в конструкторе. Если указано UNKNOWN, эта зона будет использоваться, если введённый адрес не попадает ни в одну другую.
- `description` и `addition` - описания, отображаемые пользователю после ввода адреса.
- `free` и `price` - в версии для modx мной нигде не используются, но наверное вам пригодятся.

Зона юзера и ее описание хранятся в [глобальном хранилище](../globalStore.md). Доступ к ним можно получить следующим образом:

```js
console.log(globalStore.delivery.userZone)
```

После ввода или изменения адреса, а также при переключении способов заказа, значение `userZone` обновляется. Для отслеживания изменений можно подписаться на событие:

```js
globalStore.delivery.subscribe((e) => {
  console.log(e, globalStore.delivery.userZone)
})
```
